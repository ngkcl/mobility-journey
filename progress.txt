## Codebase Patterns
- Use valid expo-router typed routes (e.g. /analysis) for Link hrefs to satisfy typecheck.
- Unit tests run via `node --test` and use `ts-node/register/transpile-only` to import TS modules.

---
## 2026-02-07 12:32 - Story AP-002: Install and configure react-native-headphone-motion

### Completed
- Installed react-native-headphone-motion dependency.
- Added `useHeadphoneMotion` hook with permission handling, subscriptions, and graceful fallback.
- Marked AP-002 as passing in `prd.json`.

### Next Up (for next iteration)
- [ ] Implement AP-003: slouch detection engine with calibration and debouncing.
- [ ] Wire slouch detection into a new posture monitor screen.

### Blockers/Warnings
- `git push` failed because no `origin` remote is configured.

### Files Changed
- lib/useHeadphoneMotion.ts
- package.json
- pnpm-lock.yaml
- prd.json
- progress.txt

### Learnings (add to Codebase Patterns if reusable)
- None.
---
## 2026-02-07 12:29 - Story AP-001: Switch to development build with expo-dev-client

### Completed
- Installed expo-dev-client and updated lockfile.
- Set iOS bundle identifier and NSMotionUsageDescription in app.json.
- Ran `npx expo prebuild` successfully to generate native folders.
- Fixed expo-router typed Link target in not-found screen to pass typecheck.

### Next Up (for next iteration)
- [ ] Implement AP-002: add react-native-headphone-motion and create hook.
- [ ] Add motion permission handling and fallback UI behavior.

### Blockers/Warnings
- CocoaPods gem install failed; Homebrew install succeeded during prebuild.
- Native folders `ios/` and `android/` are gitignored; regenerate as needed.
- `git push` failed because no `origin` remote is configured.

### Files Changed
- app.json
- app/+not-found.tsx
- package.json
- pnpm-lock.yaml
- prd.json
- progress.txt

### Learnings (add to Codebase Patterns if reusable)
- Expo prebuild will try gem install for CocoaPods first, then fall back to Homebrew.
---
---
## 2026-02-07 12:35 - Story AP-003: Slouch detection engine

### Completed
- Added slouch detection engine with calibration, thresholds, debouncing, and state transitions.
- Emitted slouch events on WARNING/SLOUCHING transitions with timestamp and duration metadata.
- Added node-based unit tests for slouch detection logic.

### Next Up (for next iteration)
- [ ] Implement AP-004: posture monitor screen with real-time feedback using slouch detector + headphone motion hook.
- [ ] Consider wiring detector into UI state with live stats + session timer.

### Blockers/Warnings
- `git push` failed because no `origin` remote is configured.

### Files Changed
- lib/slouchDetector.ts
- lib/slouchDetector.test.js
- package.json
- pnpm-lock.yaml
- prd.json
- progress.txt

### Learnings (add to Codebase Patterns if reusable)
- None.
---
---
## 2026-02-07 12:40 - Story AP-004: Posture monitor screen with real-time feedback

### Completed
- Added Posture tab screen with live status indicator, calibration control, angle readouts, session timer, and stats.
- Wired slouch detector updates into session stats and state transitions.
- Added posture session formatting helpers with unit tests.

### Next Up (for next iteration)
- [ ] Implement AP-005: haptic and sound alerts with settings + cooldown.
- [ ] Start AP-006: Supabase session logging and history view integration.

### Blockers/Warnings
- `git push` will fail because no `origin` remote is configured.

### Files Changed
- app/(tabs)/_layout.tsx
- app/(tabs)/posture.tsx
- lib/postureSession.ts
- lib/postureSession.test.js
- prd.json
- progress.txt

### Learnings (add to Codebase Patterns if reusable)
- None.
---
---
## 2026-02-07 12:43 - Story AP-005: Slouch alerts with haptic and sound

### Completed
- Added posture alert settings (sensitivity, alert delay, haptics, sound) with AsyncStorage persistence.
- Wired haptic + optional sound alerts with 30s cooldown into posture monitoring.
- Added alert tone asset and settings normalization tests.

### Next Up (for next iteration)
- [ ] Implement AP-006: Supabase session logging and posture history view.
- [ ] Integrate posture data into Progress Charts tab.

### Blockers/Warnings
- `git push` will fail because no `origin` remote is configured.

### Files Changed
- app/(tabs)/posture.tsx
- lib/postureSettings.ts
- lib/postureSettings.test.js
- assets/sounds/alert.wav
- package.json
- pnpm-lock.yaml
- prd.json
- progress.txt

### Learnings (add to Codebase Patterns if reusable)
- None.
---
---
## 2026-02-07 12:49 - Story AP-006: Posture session history and Supabase logging

### Completed
- Documented posture_sessions table schema in Supabase migration.
- Logged posture sessions on stop with average pitch, slouch count, and good posture percentage.
- Added posture session history list in Posture screen with refresh handling.
- Integrated daily/weekly posture trend chart and export data in Progress Charts.
- Added posture trend aggregation helpers and unit tests.

### Next Up (for next iteration)
- [ ] Implement AP-007: camera-based posture detection module for web and native.
- [ ] Explore posture alerts parity for camera-based detection.

### Blockers/Warnings
- `git push` will fail because no `origin` remote is configured.

### Files Changed
- supabase/migrations/20260207_posture_sessions.sql
- lib/types.ts
- lib/postureSessions.ts
- lib/postureSessions.test.js
- app/(tabs)/posture.tsx
- app/(tabs)/charts.tsx
- prd.json
- progress.txt

### Learnings (add to Codebase Patterns if reusable)
- None.
---
